<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skillify Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #08090d;
            --panel: #0f1117;
            --panel-hover: #161822;
            --border: rgba(255, 255, 255, 0.08);
            --text: #ffffff;
            --text-muted: #6b7280;
            --primary: #6366f1;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --purple: #a855f7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 24px 16px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0 8px 24px;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .brand-logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .brand span {
            font-weight: 700;
            font-size: 18px;
        }

        .nav-section {
            margin-bottom: 24px;
        }

        .nav-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 0 12px;
            margin-bottom: 8px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            color: var(--text-muted);
            transition: 0.2s;
            font-size: 14px;
        }

        .nav-item:hover {
            background: var(--panel-hover);
            color: var(--text);
        }

        .nav-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
        }

        .nav-item i {
            font-size: 20px;
        }

        .user-info {
            margin-top: auto;
            padding: 16px;
            background: var(--panel-hover);
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 30px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            filter: brightness(1.1);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-secondary {
            background: transparent;
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--panel-hover);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
        }

        .stat-card.highlight {
            border-color: var(--primary);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 16px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 14px;
        }

        .stat-change {
            font-size: 12px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-change.up {
            color: var(--success);
        }

        .stat-change.down {
            color: var(--danger);
        }

        /* Views */
        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        /* Tables */
        .table-container {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
        }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            font-size: 16px;
        }

        .search-input {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 16px;
            color: var(--text);
            font-family: inherit;
            width: 250px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 16px 20px;
            text-align: left;
        }

        th {
            font-size: 12px;
            text-transform: uppercase;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
        }

        tr:hover {
            background: var(--panel-hover);
        }

        td {
            border-bottom: 1px solid var(--border);
        }

        .user-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-cell-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
        }

        .user-cell-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .user-cell-name {
            font-weight: 600;
        }

        .user-cell-email {
            font-size: 12px;
            color: var(--text-muted);
        }

        .role-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .role-admin {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary);
        }

        .role-user {
            background: rgba(107, 114, 128, 0.2);
            color: var(--text-muted);
        }

        .actions-cell {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }

        .action-btn:hover {
            background: var(--panel-hover);
            color: var(--text);
        }

        .action-btn.danger:hover {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border-color: var(--danger);
        }

        /* Activity Feed */
        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-message {
            margin-bottom: 4px;
        }

        .activity-time {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            width: 500px;
            max-width: 90%;
        }

        .modal h2 {
            margin-bottom: 20px;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 12px 16px;
            color: var(--text);
            font-family: inherit;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Toggle */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: var(--panel-hover);
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .toggle {
            width: 48px;
            height: 26px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 100px;
            position: relative;
            cursor: pointer;
        }

        .toggle.active {
            background: var(--primary);
        }

        .toggle::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: 0.2s;
        }

        .toggle.active::after {
            left: 25px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-muted);
            cursor: pointer;
            font-family: inherit;
            font-weight: 600;
            transition: 0.2s;
        }

        .tab:hover {
            color: var(--text);
        }

        .tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-logo"><i class="ph ph-diamond"></i></div>
                <span>Skillify Admin</span>
            </div>

            <div class="nav-section">
                <div class="nav-label">Dashboard</div>
                <div class="nav-item active" onclick="switchView('overview')">
                    <i class="ph ph-squares-four"></i> Overview
                </div>
                <div class="nav-item" onclick="switchView('analytics')">
                    <i class="ph ph-chart-line"></i> Analytics
                </div>
                <div class="nav-item" onclick="switchView('leaderboard')">
                    <i class="ph ph-trophy"></i> Leaderboard
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-label">Users</div>
                <div class="nav-item" onclick="switchView('users')">
                    <i class="ph ph-users"></i> All Users
                </div>
                <div class="nav-item" onclick="switchView('admins')">
                    <i class="ph ph-shield-check"></i> Admins
                </div>
                <div class="nav-item" onclick="switchView('banned')">
                    <i class="ph ph-prohibit"></i> Banned
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-label">Content</div>
                <div class="nav-item" onclick="switchView('courses')">
                    <i class="ph ph-graduation-cap"></i> Courses
                </div>
                <div class="nav-item" onclick="switchView('announcements')">
                    <i class="ph ph-megaphone"></i> Announcements
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-label">Business</div>
                <div class="nav-item" onclick="switchView('coupons')">
                    <i class="ph ph-ticket"></i> Coupons
                </div>
                <div class="nav-item" onclick="switchView('payments')">
                    <i class="ph ph-credit-card"></i> Payments
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-label">Tools</div>
                <div class="nav-item" onclick="switchView('messages')">
                    <i class="ph ph-paper-plane-tilt"></i> Messages
                </div>
                <div class="nav-item" onclick="switchView('activity')">
                    <i class="ph ph-pulse"></i> Activity Log
                </div>
                <div class="nav-item" onclick="switchView('sections')">
                    <i class="ph ph-toggle-left"></i> Sections
                </div>
                <div class="nav-item" onclick="switchView('emails')">
                    <i class="ph ph-envelope"></i> Email Templates
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-label">System</div>
                <div class="nav-item" onclick="switchView('settings')">
                    <i class="ph ph-gear"></i> Settings
                </div>
                <div class="nav-item" onclick="window.location.href='/dashboard.html'">
                    <i class="ph ph-arrow-left"></i> Back to Site
                </div>
            </div>

            <div class="user-info" id="adminInfo">
                <div class="user-avatar">A</div>
                <div>
                    <div style="font-weight:600; font-size:14px;">Admin</div>
                    <div style="font-size:12px; color:var(--text-muted);">Superuser</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- OVERVIEW VIEW -->
            <div id="view-overview" class="view active">
                <div class="header">
                    <div>
                        <h1>Dashboard Overview</h1>
                        <p style="color:var(--text-muted); margin-top:4px;">Platform statistics and metrics</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="refreshData()">
                            <i class="ph ph-arrow-clockwise"></i> Refresh
                        </button>
                        <button class="btn btn-primary" onclick="exportData()">
                            <i class="ph ph-download"></i> Export
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background:rgba(99, 102, 241, 0.2); color:var(--primary);">
                            <i class="ph ph-users"></i>
                        </div>
                        <div class="stat-value" id="statUsers">-</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:rgba(16, 185, 129, 0.2); color:var(--success);">
                            <i class="ph ph-user-check"></i>
                        </div>
                        <div class="stat-value" id="statActive">-</div>
                        <div class="stat-label">Active Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:rgba(168, 85, 247, 0.2); color:var(--purple);">
                            <i class="ph ph-chat-circle"></i>
                        </div>
                        <div class="stat-value" id="statPosts">-</div>
                        <div class="stat-label">Community Posts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background:rgba(251, 191, 36, 0.2); color:var(--warning);">
                            <i class="ph ph-check-square"></i>
                        </div>
                        <div class="stat-value" id="statTasks">-</div>
                        <div class="stat-label">Tasks Created</div>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Recent Activity</h3>
                        </div>
                        <div style="padding:16px; max-height:400px; overflow-y:auto;" id="recentActivity">
                            <!-- JS -->
                        </div>
                    </div>
                    <div class="table-container">
                        <div class="table-header">
                            <h3>New Users</h3>
                        </div>
                        <div style="padding:16px; max-height:400px; overflow-y:auto;" id="newUsers">
                            <!-- JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- USERS VIEW -->
            <div id="view-users" class="view">
                <div class="header">
                    <div>
                        <h1>User Management</h1>
                        <p style="color:var(--text-muted); margin-top:4px;">View and manage all users</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="exportUsers()">
                            <i class="ph ph-download"></i> Export CSV
                        </button>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3>All Users (<span id="userCount">0</span>)</h3>
                        <input type="text" class="search-input" placeholder="Search users..." id="userSearch"
                            oninput="searchUsers()">
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>XP / Level</th>
                                <th>Last Active</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <!-- JS -->
                        </tbody>
                    </table>
                    <div style="padding:16px; display:flex; justify-content:between; gap:12px;" id="usersPagination">
                        <!-- JS -->
                    </div>
                </div>
            </div>

            <!-- ADMINS VIEW -->
            <div id="view-admins" class="view">
                <div class="header">
                    <div>
                        <h1>Admin Management</h1>
                        <p style="color:var(--text-muted); margin-top:4px;">Manage admin roles</p>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Current Admins</h3>
                        </div>
                        <div id="adminsList" style="padding:16px;">
                            <!-- JS -->
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <h3>Promote User to Admin</h3>
                        </div>
                        <div style="padding:20px;">
                            <div class="form-group">
                                <label class="form-label">Search user by email</label>
                                <input type="email" class="form-input" id="promoteEmail" placeholder="user@example.com">
                            </div>
                            <button class="btn btn-primary" onclick="promoteToAdmin()">
                                <i class="ph ph-shield-plus"></i> Promote to Admin
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MESSAGES VIEW -->
            <div id="view-messages" class="view">
                <div class="header">
                    <div>
                        <h1>Messaging</h1>
                        <p style="color:var(--text-muted); margin-top:4px;">Send messages to users</p>
                    </div>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="switchMessageTab('broadcast', this)">Broadcast All</button>
                    <button class="tab" onclick="switchMessageTab('single', this)">Single User</button>
                </div>

                <div id="msgBroadcast" class="table-container" style="padding:24px;">
                    <h3 style="margin-bottom:20px;">‚ö° Broadcast to All Users</h3>
                    <div class="form-group">
                        <label class="form-label">Subject</label>
                        <input type="text" class="form-input" id="broadcastSubject" placeholder="Announcement subject">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Message</label>
                        <textarea class="form-textarea" id="broadcastMessage"
                            placeholder="Write your message..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="sendBroadcast()">
                        <i class="ph ph-paper-plane-tilt"></i> Send to All Users
                    </button>
                </div>

                <div id="msgSingle" class="table-container" style="padding:24px; display:none;">
                    <h3 style="margin-bottom:20px;">üìß Send to Single User</h3>
                    <div class="form-group">
                        <label class="form-label">User Email</label>
                        <input type="email" class="form-input" id="singleEmail" placeholder="user@example.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Subject</label>
                        <input type="text" class="form-input" id="singleSubject" placeholder="Message subject">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Message</label>
                        <textarea class="form-textarea" id="singleMessage"
                            placeholder="Write your message..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="sendSingleMessage()">
                        <i class="ph ph-paper-plane-tilt"></i> Send Message
                    </button>
                </div>
            </div>

            <!-- ACTIVITY VIEW -->
            <div id="view-activity" class="view">
                <div class="header">
                    <div>
                        <h1>Activity Log</h1>
                        <p style="color:var(--text-muted); margin-top:4px;">Track all user activities</p>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h3>User Activity</h3>
                        <input type="text" class="search-input" placeholder="Filter by username..." id="activitySearch">
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Action</th>
                                <th>Details</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody id="activityTable">
                            <!-- JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- SECTIONS VIEW -->
            <div id="view-sections" class="view">
                <div class="header">
                    <div>
                        <h1>Section Management</h1>
                        <p style="color:var(--text-muted); margin-top:4px;">Enable or disable platform sections</p>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Dashboard Sections</h3>
                        </div>
                        <div style="padding:16px;" id="dashboardSections">
                            <div class="toggle-container">
                                <div>
                                    <div style="font-weight:600;">Learning Path</div>
                                    <div style="font-size:12px; color:var(--text-muted);">Roadmap and courses</div>
                                </div>
                                <div class="toggle active" onclick="toggleSection('roadmap', this)"></div>
                            </div>
                            <div class="toggle-container">
                                <div>
                                    <div style="font-weight:600;">Community</div>
                                    <div style="font-size:12px; color:var(--text-muted);">Social feed and posts</div>
                                </div>
                                <div class="toggle active" onclick="toggleSection('community', this)"></div>
                            </div>
                            <div class="toggle-container">
                                <div>
                                    <div style="font-weight:600;">Challenges</div>
                                    <div style="font-size:12px; color:var(--text-muted);">Weekly challenges</div>
                                </div>
                                <div class="toggle active" onclick="toggleSection('challenges', this)"></div>
                            </div>
                            <div class="toggle-container">
                                <div>
                                    <div style="font-weight:600;">Certificates</div>
                                    <div style="font-size:12px; color:var(--text-muted);">Course certificates</div>
                                </div>
                                <div class="toggle active" onclick="toggleSection('certificates', this)"></div>
                            </div>
                            <div class="toggle-container">
                                <div>
                                    <div style="font-weight:600;">Calendar</div>
                                    <div style="font-size:12px; color:var(--text-muted);">Schedule and events</div>
                                </div>
                                <div class="toggle active" onclick="toggleSection('calendar', this)"></div>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <h3>Feature Flags</h3>
                        </div>
                        <div style="padding:16px;">
                            <div class="toggle-container">
                                <div>
                                    <div style="font-weight:600;">Payments</div>
                                    <div style="font-size:12px; color:var(--text-muted);">Stripe/PayPal integration
                                    </div>
                                </div>
                                <div class="toggle active" onclick="toggleFeature('payments', this)"></div>
                            </div>
                            <div class="toggle-container">
                                <div>
                                    <div style="font-weight:600;">Email Notifications</div>
                                    <div style="font-size:12px; color:var(--text-muted);">Send emails to users</div>
                                </div>
                                <div class="toggle active" onclick="toggleFeature('emails', this)"></div>
                            </div>
                            <div class="toggle-container">
                                <div>
                                    <div style="font-weight:600;">Registration</div>
                                    <div style="font-size:12px; color:var(--text-muted);">Allow new signups</div>
                                </div>
                                <div class="toggle active" onclick="toggleFeature('registration', this)"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SETTINGS VIEW -->
            <div id="view-settings" class="view">
                <div class="header">
                    <div>
                        <h1>System Settings</h1>
                        <p style="color:var(--text-muted); margin-top:4px;">Configure platform settings</p>
                    </div>
                </div>

                <div class="grid-2">
                    <div class="table-container" style="padding:24px;">
                        <h3 style="margin-bottom:20px;">Platform Info</h3>
                        <div class="form-group">
                            <label class="form-label">Site Name</label>
                            <input type="text" class="form-input" value="Skillify">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Admin Email</label>
                            <input type="email" class="form-input" value="admin@skillify.com">
                        </div>
                        <button class="btn btn-primary">Save Settings</button>
                    </div>

                    <div class="table-container" style="padding:24px;">
                        <h3 style="margin-bottom:20px;">Danger Zone</h3>
                        <button class="btn btn-danger" style="width:100%; margin-bottom:12px;" onclick="clearAllData()">
                            <i class="ph ph-trash"></i> Clear All Posts
                        </button>
                        <button class="btn btn-danger" style="width:100%;" onclick="resetSystem()">
                            <i class="ph ph-warning"></i> Reset System
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ============ VIEW SWITCHING ============
        function switchView(view) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('view-' + view).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            event.target.closest('.nav-item').classList.add('active');

            // Load data for view
            if (view === 'overview') loadOverview();
            if (view === 'users') loadUsers();
            if (view === 'admins') loadAdmins();
            if (view === 'activity') loadActivity();
        }

        // ============ LOAD OVERVIEW ============
        async function loadOverview() {
            try {
                const res = await fetch('/api/admin/stats');
                if (!res.ok) throw new Error('Not authorized');
                const data = await res.json();

                document.getElementById('statUsers').textContent = data.users;
                document.getElementById('statActive').textContent = data.activeNow;
                document.getElementById('statPosts').textContent = data.posts;
                document.getElementById('statTasks').textContent = data.tasks;

                // Load recent activity
                loadRecentActivity();
            } catch (e) {
                console.error('Failed to load stats:', e);
                alert('Access denied. Are you an admin?');
            }
        }

        async function loadRecentActivity() {
            try {
                const res = await fetch('/api/admin/activity');
                if (!res.ok) return;
                const activity = await res.json();

                const container = document.getElementById('recentActivity');
                container.innerHTML = activity.slice(0, 10).map(a => `
                    <div class="activity-item">
                        <div class="activity-icon" style="background:rgba(99, 102, 241, 0.2); color:var(--primary);">
                            <i class="ph ph-${a.type === 'USER' ? 'user-plus' : a.type === 'POST' ? 'chat-circle' : 'check-square'}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-message">${a.msg}</div>
                            <div class="activity-time">${timeAgo(a.time)}</div>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('Failed to load activity:', e);
            }
        }

        // ============ LOAD USERS ============
        let allUsers = [];
        async function loadUsers(page = 1) {
            try {
                const res = await fetch(`/api/admin/users?page=${page}&limit=50`);
                if (!res.ok) return;
                const data = await res.json();
                allUsers = data.users;

                document.getElementById('userCount').textContent = data.totalItems;
                renderUsers(allUsers);
            } catch (e) {
                console.error('Failed to load users:', e);
            }
        }

        function renderUsers(users) {
            const tbody = document.getElementById('usersTable');
            tbody.innerHTML = users.map(u => `
                <tr>
                    <td>
                        <div class="user-cell">
                            <div class="user-cell-avatar">${(u.username || 'U')[0].toUpperCase()}</div>
                            <div class="user-cell-info">
                                <div class="user-cell-name">${u.username}</div>
                            </div>
                        </div>
                    </td>
                    <td style="color:var(--text-muted); font-size:13px;">${u.email}</td>
                    <td><span class="role-badge ${u.role === 'admin' ? 'role-admin' : 'role-user'}">${u.role}</span></td>
                    <td>${u.xp || 0} XP / Lvl ${u.level || 1}</td>
                    <td style="color:var(--text-muted); font-size:13px;">${u.lastLoginDate ? timeAgo(u.lastLoginDate) : 'Never'}</td>
                    <td>
                        <div class="actions-cell">
                            <button class="action-btn" onclick="viewUser('${u.id}')" title="View Details">
                                <i class="ph ph-eye"></i>
                            </button>
                            <button class="action-btn" onclick="messageUser('${u.email}')" title="Send Message">
                                <i class="ph ph-envelope"></i>
                            </button>
                            ${u.role !== 'admin' ? `
                                <button class="action-btn danger" onclick="deleteUser('${u.id}')" title="Delete User">
                                    <i class="ph ph-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function searchUsers() {
            const query = document.getElementById('userSearch').value.toLowerCase();
            const filtered = allUsers.filter(u =>
                u.username.toLowerCase().includes(query) ||
                u.email.toLowerCase().includes(query)
            );
            renderUsers(filtered);
        }

        // ============ LOAD ADMINS ============
        async function loadAdmins() {
            try {
                const res = await fetch('/api/admin/users?limit=100');
                if (!res.ok) return;
                const data = await res.json();
                const admins = data.users.filter(u => u.role === 'admin');

                const container = document.getElementById('adminsList');
                if (admins.length === 0) {
                    container.innerHTML = '<div class="empty-state"><i class="ph ph-shield-check"></i><p>No admins found</p></div>';
                    return;
                }

                container.innerHTML = admins.map(a => `
                    <div style="display:flex; align-items:center; justify-content:space-between; padding:12px; background:var(--panel-hover); border-radius:10px; margin-bottom:8px;">
                        <div class="user-cell">
                            <div class="user-cell-avatar">${a.username[0].toUpperCase()}</div>
                            <div class="user-cell-info">
                                <div class="user-cell-name">${a.username}</div>
                                <div class="user-cell-email">${a.email}</div>
                            </div>
                        </div>
                        <button class="btn btn-danger" style="padding:6px 12px; font-size:12px;" onclick="demoteAdmin('${a.id}')">
                            <i class="ph ph-shield-slash"></i> Demote
                        </button>
                    </div>
                `).join('');
            } catch (e) {
                console.error('Failed to load admins:', e);
            }
        }

        async function promoteToAdmin() {
            const email = document.getElementById('promoteEmail').value;
            if (!email) return alert('Enter email');

            try {
                const res = await fetch('/api/admin/promote', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                });
                const data = await res.json();
                alert(data.message);
                loadAdmins();
            } catch (e) {
                alert('Failed to promote user');
            }
        }

        async function demoteAdmin(id) {
            if (!confirm('Demote this admin?')) return;

            try {
                const res = await fetch('/api/admin/demote', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: id })
                });
                const data = await res.json();
                alert(data.message);
                loadAdmins();
            } catch (e) {
                alert('Failed to demote admin');
            }
        }

        // ============ DELETE USER ============
        async function deleteUser(id) {
            if (!confirm('Are you sure you want to delete this user? This cannot be undone.')) return;

            try {
                const res = await fetch(`/api/admin/users/${id}`, { method: 'DELETE' });
                const data = await res.json();
                alert(data.message);
                loadUsers();
            } catch (e) {
                alert('Failed to delete user');
            }
        }

        // ============ VIEW USER DETAILS ============
        function viewUser(id) {
            const user = allUsers.find(u => u.id === id);
            if (!user) return;

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal" style="position:relative;">
                    <button class="modal-close" onclick="this.parentElement.parentElement.remove()">&times;</button>
                    <h2>User Details</h2>
                    <div style="display:flex; align-items:center; gap:16px; margin-bottom:24px;">
                        <div class="user-cell-avatar" style="width:60px; height:60px; font-size:24px;">
                            ${user.username[0].toUpperCase()}
                        </div>
                        <div>
                            <div style="font-size:20px; font-weight:700;">${user.username}</div>
                            <div style="color:var(--text-muted);">${user.email}</div>
                        </div>
                    </div>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
                        <div style="background:var(--panel-hover); padding:16px; border-radius:12px;">
                            <div style="color:var(--text-muted); font-size:12px; margin-bottom:4px;">Role</div>
                            <div style="font-weight:600;">${user.role}</div>
                        </div>
                        <div style="background:var(--panel-hover); padding:16px; border-radius:12px;">
                            <div style="color:var(--text-muted); font-size:12px; margin-bottom:4px;">XP / Level</div>
                            <div style="font-weight:600;">${user.xp || 0} / Lvl ${user.level || 1}</div>
                        </div>
                        <div style="background:var(--panel-hover); padding:16px; border-radius:12px;">
                            <div style="color:var(--text-muted); font-size:12px; margin-bottom:4px;">Verified</div>
                            <div style="font-weight:600;">${user.isVerified ? '‚úÖ Yes' : '‚ùå No'}</div>
                        </div>
                        <div style="background:var(--panel-hover); padding:16px; border-radius:12px;">
                            <div style="color:var(--text-muted); font-size:12px; margin-bottom:4px;">Last Login</div>
                            <div style="font-weight:600;">${user.lastLoginDate ? timeAgo(user.lastLoginDate) : 'Never'}</div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
        }

        // ============ MESSAGING ============
        function switchMessageTab(tab, btn) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            btn.classList.add('active');

            document.getElementById('msgBroadcast').style.display = tab === 'broadcast' ? 'block' : 'none';
            document.getElementById('msgSingle').style.display = tab === 'single' ? 'block' : 'none';
        }

        async function sendBroadcast() {
            const subject = document.getElementById('broadcastSubject').value;
            const message = document.getElementById('broadcastMessage').value;

            if (!subject || !message) return alert('Fill all fields');

            try {
                const res = await fetch('/api/admin/broadcast', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ subject, message })
                });
                const data = await res.json();
                alert(data.message || 'Broadcast sent!');
            } catch (e) {
                alert('Failed to send broadcast');
            }
        }

        function messageUser(email) {
            switchView('messages');
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab')[1].classList.add('active');
            document.getElementById('msgBroadcast').style.display = 'none';
            document.getElementById('msgSingle').style.display = 'block';
            document.getElementById('singleEmail').value = email;
        }

        async function sendSingleMessage() {
            const email = document.getElementById('singleEmail').value;
            const subject = document.getElementById('singleSubject').value;
            const message = document.getElementById('singleMessage').value;

            if (!email || !subject || !message) return alert('Fill all fields');

            try {
                const res = await fetch('/api/admin/message', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, subject, message })
                });
                const data = await res.json();
                alert(data.message || 'Message sent!');
            } catch (e) {
                alert('Failed to send message');
            }
        }

        // ============ ACTIVITY LOG ============
        async function loadActivity() {
            try {
                const res = await fetch('/api/admin/activity');
                if (!res.ok) return;
                const activity = await res.json();

                const tbody = document.getElementById('activityTable');
                tbody.innerHTML = activity.map(a => `
                    <tr>
                        <td>${a.user || 'System'}</td>
                        <td><span class="role-badge" style="background:rgba(99, 102, 241, 0.2); color:var(--primary);">${a.type}</span></td>
                        <td>${a.msg}</td>
                        <td style="color:var(--text-muted); font-size:13px;">${timeAgo(a.time)}</td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('Failed to load activity:', e);
            }
        }

        // ============ SECTIONS TOGGLE ============
        function toggleSection(section, el) {
            el.classList.toggle('active');
            const enabled = el.classList.contains('active');

            // Save to localStorage
            const sections = JSON.parse(localStorage.getItem('skillify_sections') || '{}');
            sections[section] = enabled;
            localStorage.setItem('skillify_sections', JSON.stringify(sections));

            alert(`${section} ${enabled ? 'enabled' : 'disabled'}`);
        }

        function toggleFeature(feature, el) {
            el.classList.toggle('active');
            const enabled = el.classList.contains('active');

            const features = JSON.parse(localStorage.getItem('skillify_features') || '{}');
            features[feature] = enabled;
            localStorage.setItem('skillify_features', JSON.stringify(features));

            alert(`${feature} ${enabled ? 'enabled' : 'disabled'}`);
        }

        // ============ UTILITIES ============
        function timeAgo(date) {
            const seconds = Math.floor((new Date() - new Date(date)) / 1000);
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }

        function refreshData() {
            loadOverview();
            alert('Data refreshed!');
        }

        function exportData() {
            alert('Export feature coming soon!');
        }

        function exportUsers() {
            const csv = allUsers.map(u => `${u.username},${u.email},${u.role},${u.xp || 0}`).join('\n');
            const blob = new Blob(['Username,Email,Role,XP\n' + csv], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'users.csv';
            a.click();
        }

        function clearAllData() {
            if (confirm('This will delete ALL posts. Are you sure?')) {
                alert('Feature coming soon');
            }
        }

        function resetSystem() {
            if (confirm('‚ö†Ô∏è This is DANGEROUS. Are you sure?')) {
                if (prompt('Type "RESET" to confirm') === 'RESET') {
                    alert('Feature disabled for safety');
                }
            }
        }

        // ============ INIT ============
        loadOverview();
    </script>
    <script src="js/adminAdvanced.js"></script>
</body>

</html>